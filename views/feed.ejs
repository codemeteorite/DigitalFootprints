<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Digital Footprints ‚Äî Feed</title>

  <!-- Royal Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    :root {
      --glass-bg: rgba(255,255,255,0.04);
      --card-border-dark: #2f3740;
      --card-border-light: #e6e9ef;
    }

    /* tiny fade-in for cards */
    @keyframes cardFadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .card-appear {
      opacity: 0;
      animation: cardFadeUp .45s ease forwards;
    }

    /* slightly reduce border visibility in dark mode */
    .card-border {
      border: 1px solid var(--card-border-light);
    }
    .dark .card-border {
      border-color: var(--card-border-dark);
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.04));
    }

    /* subtle header underline */
    .hdr-underline::after {
      content: "";
      display: block;
      width: 48px;
      height: 4px;
      margin: 12px auto 0;
      border-radius: 999px;
      background: linear-gradient(90deg,#7c4dff,#4f93ff);
      opacity: .95;
    }

    /* make timeago a bit muted */
    .timeago { opacity: .75; }

    /* clamp content lines for card preview */
    .clamp-3 {
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 3;
      overflow: hidden;
    }

    /* accessible focus ring for toggle */
    .focus-ring:focus { outline: 3px solid rgba(99,102,241,0.18); outline-offset: 3px; }

    /* floating profile button small shadow tweak */
    .fab {
      box-shadow: 0 8px 30px rgba(20,20,30,0.45);
    }
  </style>

  <script>
    tailwind.config = { darkMode: "class" };
    if (!localStorage.theme) localStorage.theme = "dark";
    if (localStorage.theme === "dark") document.documentElement.classList.add("dark");
    else document.documentElement.classList.remove("dark");
  </script>
</head>

<body class="bg-gray-100 dark:bg-[#0f1720] min-h-screen transition-colors duration-300 text-gray-900 dark:text-gray-100">

  <!-- NAVBAR -->
  <nav class="w-full px-6 py-4 bg-white dark:bg-[#0b1220] shadow-sm sticky top-0 z-50">
    <div class="max-w-7xl mx-auto flex items-center gap-6">
      <!-- Logout -->
      <a href="/logout" class="group">
        <div class="relative inline-flex items-center gap-3 px-4 py-2 rounded-xl transition transform hover:scale-[1.02]">
          <div class="rounded-lg p-[6px] bg-gradient-to-br from-red-500 to-transparent">
            <div class="bg-black rounded-md px-3 py-1 flex items-center gap-3 text-white font-semibold">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 fill-white"><path d="M16 13v-2H7V8l-5 4 5 4v-3h9zm3-11H5c-1.1 0-2 .9-2 2v4h2V4h14v16H5v-4H3v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
              Logout
            </div>
          </div>
        </div>
      </a>

      <!-- Title (centered by flex grow) -->
      <div class="flex-1 text-center">
        <div class="flex items-center justify-center gap-4">
          <h1 class="royal-title text-3xl sm:text-4xl font-semibold tracking-tight 
                     bg-gradient-to-r from-[#7c4dff] to-[#5aa0ff] bg-clip-text text-transparent">
            Digital Footprints
          </h1>
        </div>
        <div class="mt-1">
          <p class="text-sm text-gray-600 dark:text-gray-400">A public pulse of people‚Äôs thoughts</p>
        </div>
      </div>

      <!-- Small header image (uses uploaded file) -->
      <div class="flex items-center gap-3">
        <!-- Developer-provided local image path used as requested -->
        <img src="/mnt/data/0531c469-026a-4323-9998-dcbc87cf47a0.png"
             alt="Logo" class="w-11 h-11 rounded-full object-cover ring-1 ring-white/10 shadow-sm hidden md:block" />

        <!-- Theme toggle -->
        <button id="themeToggle" aria-label="Toggle dark mode"
                class="focus-ring rounded-full p-2 bg-gray-200 dark:bg-gray-700 text-lg transition hover:scale-105">
          <span id="themeIcon">üåô</span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Page Header -->
  <header class="max-w-7xl mx-auto px-6 mt-8">
    <div class="text-center">
      <h2 class="royal-title text-4xl sm:text-5xl font-extrabold leading-tight hdr-underline">Digital Footprints</h2>
      <p class="mt-3 text-lg text-gray-600 dark:text-gray-300 max-w-2xl mx-auto">
        Look what's moving in people's head
      </p>
    </div>
  </header>

  <!-- FEED -->
  <main class="max-w-7xl mx-auto px-6 mt-8 pb-28">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <% posts.forEach((p, idx) => { %>
        <article
          class="relative card-appear card-border rounded-xl p-6 bg-white dark:bg-[#0b1220] shadow-sm hover:shadow-xl transition-all duration-300 overflow-hidden"
          style="animation-delay: <%= (idx * 60) %>ms;"
        >
          <!-- blue swoosh (kept), but tuned for depth -->
          <div aria-hidden="true"
               class="pointer-events-none absolute top-0 right-[-40px] w-[50px] h-full transform skew-x-[10deg]
                      bg-[linear-gradient(180deg,#4f4fee,#6d6dff)] opacity-0 transition-all duration-300
                      hover:opacity-100" style="filter: blur(0.4px)"></div>

          <!-- action (stalk) -->
          <form method="GET" action="/users/<%= p.user_id %>/stalkerview" class="flex justify-end z-10">
            <button title="View user" class="text-lg hover:scale-110 transition" aria-label="View user">üëÅÔ∏è</button>
          </form>

          <!-- content -->
          <div class="space-y-2 mt-2">
            <p class="text-lg font-bold text-gray-900 dark:text-gray-100">@<%= p.username %></p>
            <p class="text-sm text-gray-500 dark:text-gray-400"><%= p.email %></p>

            <p class="mt-3 text-gray-800 dark:text-gray-200 clamp-3 leading-relaxed">
              <%= p.content %>
            </p>
          </div>

          <!-- footer with time -->
          <div class="mt-4 flex items-center justify-between">
            <p class="text-xs text-gray-500 dark:text-gray-400 timeago" data-time="<%= p.created_at %>"></p>
            <!-- optional small CTA or like could go here -->
          </div>
        </article>
      <% }) %>
    </div>
  </main>

  <!-- Floating Profile CTA -->
  <a href="/profile" class="fab fixed bottom-6 right-6 z-50 rounded-[18px] p-0">
    <div class="w-[150px] h-[55px] rounded-[16px] bg-gradient-to-br from-pink-500/80 to-transparent flex items-center justify-center text-white font-medium shadow-lg transform hover:scale-105 transition">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="w-5 h-5 mr-2 fill-white opacity-90">
        <path d="M12 12c2.7 0 5-2.3 5-5s-2.3-5-5-5-5 2.3-5 5 2.3 5 5 5zm0 2c-3.3 0-10 1.7-10 5v3h20v-3c0-3.3-6.7-5-10-5z"/>
      </svg>
      My Profile
    </div>
  </a>

  <!-- SCRIPTS: theme toggle + timeago (kept your logic, polished) -->
  <script>
    const toggle = document.getElementById("themeToggle");
    const themeIcon = document.getElementById("themeIcon");

    function setIcon() {
      themeIcon.textContent = document.documentElement.classList.contains("dark") ? "‚òÄÔ∏è" : "üåô";
    }

    toggle.addEventListener("click", () => {
      document.documentElement.classList.toggle("dark");
      localStorage.theme = document.documentElement.classList.contains("dark") ? "dark" : "light";
      setIcon();
    });

    // init
    setIcon();

    // cards hover swoosh activation (using event delegation for performance)
    document.querySelectorAll('article').forEach(card => {
      card.addEventListener('mouseenter', () => {
        const s = card.querySelector('div[aria-hidden="true"]');
        if (s) { s.style.right = "-6px"; s.style.opacity = "1"; }
      });
      card.addEventListener('mouseleave', () => {
        const s = card.querySelector('div[aria-hidden="true"]');
        if (s) { s.style.right = "-40px"; s.style.opacity = "0"; }
      });
    });
  </script>

  <!-- TIMEAGO -->
  <script>
    (function(){
      function timeAgo(raw) {
        const date = new Date(raw);
        if (isNaN(date)) return "just now";
        const seconds = Math.floor((Date.now() - date.getTime()) / 1000);
        const intervals = { year: 31536000, month: 2592000, week: 604800, day: 86400, hour: 3600, minute: 60 };
        for (const unit in intervals) {
          const value = Math.floor(seconds / intervals[unit]);
          if (value >= 1) return `${value} ${unit}${value > 1 ? "s" : ""} ago`;
        }
        return "just now";
      }

      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".timeago").forEach(el => {
          el.textContent = timeAgo(el.dataset.time);
        });
      });
    })();
  </script>

</body>
</html>
